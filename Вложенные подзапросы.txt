-- Вложенные запросы

--Задание. Использование подзапросов

--1.	Выведите список заказов клиента, который был зарегистрирован в БД последним.
SELECT orderid, custid
FROM [Sales].[Orders] WHERE custid =
										(SELECT Max(custid)
										 FROM [Sales].[Customers])

--2.	Выведите полные данные по клиенту, который сделал заказ в самую последнюю дату
--
SELECT *
FROM [Sales].[Customers] WHERE custid = 
							(SELECT Max(custid)
							FROM [Sales].[Orders]
							WHERE orderdate = 
									(SELECT Max(orderdate)
									 FROM [Sales].[Orders]))

--3.	Выведите список клиентов, которые не делали заказов
SELECT *
FROM [Sales].[Customers]
WHERE custid NOT IN (SELECT DISTINCT(custid)
					 FROM [Sales].[Orders])

--4.	Выведите список заказов тех клиентов, которые проживают в Mexico
--
SELECT *
FROM [Production].[Products]
WHERE productid IN (SELECT productid
					FROM [Sales].[OrderDetails]
					WHERE orderid IN 
							(SELECT orderid
							FROM [Sales].[Orders]
							WHERE custid IN
								(SELECT custid
								FROM [Sales].[Customers]
								WHERE country = 'Mexico')))
										
--5.	Выведите самые дорогие продукты в каждой категории. Детали должны присутствовать!
SELECT *
FROM [Production].[Products] AS PP
WHERE productid = (SELECT TOP 1 productid
					FROM [Production].[Products]
					WHERE categoryid = PP.categoryid
					ORDER BY unitprice DESC)
ORDER BY categoryid